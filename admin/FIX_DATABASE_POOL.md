# üîß –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î

## –ü—Ä–æ–±–ª–µ–º–∞
```
Timed out fetching a new connection from the connection pool
Current connection pool timeout: 10, connection limit: 17
```

**–≠—Ç–æ –ù–ï –ø—Ä–æ–±–ª–µ–º–∞ —Å–ª–∞–±–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞!** –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## –ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫:

1. **–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** (17 –≤–º–µ—Å—Ç–æ 50-100)
2. **–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–∞–π–º–∞—É—Ç** (10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 30-60)
3. **–ú–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** –æ—Ç email-watcher
4. **–î–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–¥–æ 3 –º–∏–Ω—É—Ç) –¥–µ—Ä–∂–∞—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª:
```bash
cd /var/www/bingo_bot/admin
nano .env
```

### 2. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É `DATABASE_URL` –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

**–ë—ã–ª–æ:**
```
DATABASE_URL="postgresql://gen_user:dastan10dz@92.51.38.85:5432/default_db"
```

**–°—Ç–∞–ª–æ:**
```
DATABASE_URL="postgresql://gen_user:dastan10dz@92.51.38.85:5432/default_db?connection_limit=100&pool_timeout=60"
```

**–ò–õ–ò –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:**
```bash
cd admin
npx tsx scripts/fix-connection-pool.ts
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
pm2 restart all
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (–æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å):
```bash
pm2 logs bingo-email-watcher --lines 50
```

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è:

- **connection_limit=100** - –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —É–≤–µ–ª–∏—á–∏—Ç—Å—è —Å 17 –¥–æ 100
- **pool_timeout=60** - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —É–≤–µ–ª–∏—á–∏—Ç—Å—è —Å 10 –¥–æ 60 —Å–µ–∫—É–Ω–¥
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—à–∏–±–∫–∏ `P2024` –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å

## ‚ö†Ô∏è –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å:

1. –£–≤–µ–ª–∏—á—å—Ç–µ `connection_limit` –¥–æ 150
2. –£–≤–µ–ª–∏—á—å—Ç–µ `pool_timeout` –¥–æ 90
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –∑–∞–≤–∏—Å—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ PostgreSQL

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:

```bash
cd admin
npx tsx scripts/check-connection-pool.ts
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

