# ๐ง ะะฐะบ ัะฐะฑะพัะฐะตั ัะตัะฒะตั Bingo Bot

## ๐ ะััะธัะตะบัััะฐ ัะธััะตะผั

ะะฐั ัะตัะฒะตั ัะพััะพะธั ะธะท **3 ะพัะฝะพะฒะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ**, ะบะพัะพััะต ัะฐะฑะพัะฐัั ะฒะผะตััะต:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะะะฌะะะะะขะะะ TELEGRAM                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
                        โผ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ   TELEGRAM BOT (Python)      โ  โ ะะพั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
         โ   ะะพัั: - (ัะปััะฐะตั Telegram) โ     ะัะธะฝะธะผะฐะตั ะบะพะผะฐะฝะดั
         โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ     ะกะพะทะดะฐะตั ะทะฐัะฒะบะธ
                        โ
                        โ HTTP ะทะฐะฟัะพัั
                        โผ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ   ADMIN API (Next.js)        โ  โ ะะดะผะธะฝ-ะฟะฐะฝะตะปั ะธ API
         โ   ะะพัั: 3001                 โ     ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพัั
         โ   ะะพะผะตะฝ: fqxgmrzplndwsyvkeu.ruโ    ะฅัะฐะฝะธั ะดะฐะฝะฝัะต
         โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                        โ
        โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
        โ               โ               โ
        โผ               โผ               โผ
โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
โ PostgreSQL  โ  โ Payment Site โ  โ  Admin UI   โ
โ  Database   โ  โ   (Flask)    โ  โ  (Frontend) โ
โ92.51.38.85: โ  โ  ะะพัั: 3002  โ  โ             โ
โ    5432     โ  โะะพะผะตะฝ:gldwue..โ  โ             โ
โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
```

---

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ัะธััะตะผะฐ

### 1๏ธโฃ **Telegram Bot** (Python + aiogram)

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะธะฝะธะผะฐะตั ะบะพะผะฐะฝะดั ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ Telegram
- ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐัะฒะบะธ ะฝะฐ ะฟะพะฟะพะปะฝะตะฝะธะต/ะฒัะฒะพะด
- ะกะพะทะดะฐะตั ัััะปะบะธ ะฝะฐ ัััะฐะฝะธัั ะพะฟะปะฐัั
- ะัะฟัะฐะฒะปัะตั ะทะฐะฟัะพัั ะฒ Admin API

**ะะดะต ะฝะฐัะพะดะธััั:** `telegram_bot/bot.py`

**ะะฐะบ ะทะฐะฟััะบะฐะตััั:**
```bash
cd telegram_bot
source venv/bin/activate
python3 bot.py
# ะธะปะธ ัะตัะตะท PM2:
pm2 start bot.py --name "bingo-bot" --interpreter python3
```

**ะะพััั:** ะะต ะธัะฟะพะปัะทัะตั ะฟะพััั (ัะฐะฑะพัะฐะตั ัะตัะตะท Telegram API)

---

### 2๏ธโฃ **Admin API** (Next.js)

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะตะดะพััะฐะฒะปัะตั REST API ะดะปั ะฒัะตั ะพะฟะตัะฐัะธะน
- ะฅัะฐะฝะธั ะดะฐะฝะฝัะต ะฒ PostgreSQL
- ะัะพะฑัะฐะถะฐะตั ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั ะดะปั ะพะฟะตัะฐัะพัะพะฒ
- ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐัะฒะบะธ, ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ััะฐะฝะทะฐะบัะธะธ

**ะะดะต ะฝะฐัะพะดะธััั:** `admin/`

**ะะฐะบ ะทะฐะฟััะบะฐะตััั:**
```bash
cd admin
npm install
npm run build
npm start  # ะฝะฐ ะฟะพััั 3001
# ะธะปะธ ัะตัะตะท PM2:
pm2 start npm --name "bingo-admin" -- start
```

**ะะพััั:** 
- ะะฐะทัะฐะฑะพัะบะฐ: `3001` (HTTP)
- Production: `3001` (ะฒะฝัััะตะฝะฝะธะน) โ Nginx โ HTTPS

**ะะพะผะตะฝั:**
- Admin Panel: `https://fqxgmrzplndwsyvkeu.ru`
- API: `https://fqxgmrzplndwsyvkeu.ru/api`

---

### 3๏ธโฃ **Payment Site** (Flask)

**ะงัะพ ะดะตะปะฐะตั:**
- ะะพะบะฐะทัะฒะฐะตั ัััะฐะฝะธัั ะพะฟะปะฐัั ั QR ะบะพะดะพะผ
- ะะตะฝะตัะธััะตั QR ะบะพะดั ะดะปั ะฑะฐะฝะบะพะฒ
- ะัะพะฑัะฐะถะฐะตั ัะฐะนะผะตั ะพะฑัะฐัะฝะพะณะพ ะพัััะตัะฐ
- ะะพะบะฐะทัะฒะฐะตั ัะตะบะฒะธะทะธัั ะดะปั ะพะฟะปะฐัั

**ะะดะต ะฝะฐัะพะดะธััั:** `payment_site/app.py`

**ะะฐะบ ะทะฐะฟััะบะฐะตััั:**
```bash
cd payment_site
source venv/bin/activate
gunicorn -w 4 -b 0.0.0.0:3002 app:app
# ะธะปะธ ัะตัะตะท PM2:
pm2 start gunicorn --name "bingo-payment" -- -w 4 -b 0.0.0.0:3002 app:app
```

**ะะพััั:** `3002` (ะฒะฝัััะตะฝะฝะธะน) โ Nginx โ HTTPS

**ะะพะผะตะฝั:** `https://gldwueprxkmbtqsnva.ru`

---

## ๐ ะะทะฐะธะผะพะดะตะนััะฒะธะต ะบะพะผะฟะพะฝะตะฝัะพะฒ

### ะัะธะผะตั: ะะพะปัะทะพะฒะฐัะตะปั ัะพัะตั ะฟะพะฟะพะปะฝะธัั ััะตั

```
1. ะะพะปัะทะพะฒะฐัะตะปั โ Telegram Bot
   ะะพะผะฐะฝะดะฐ: /deposit
   ะัะฑะพั ะบะฐะทะธะฝะพ, ะฒะฒะพะด ััะผะผั

2. Telegram Bot โ Admin API
   POST https://fqxgmrzplndwsyvkeu.ru/api/payment
   { telegram_user_id, amount, bookmaker, ... }

3. Admin API โ PostgreSQL
   ะกะพััะฐะฝะตะฝะธะต ะทะฐัะฒะบะธ ะฒ ะะ
   ะกัะฐััั: "pending"

4. Admin API โ Telegram Bot
   ะัะฒะตั: { id, transactionId }

5. Telegram Bot โ ะะพะปัะทะพะฒะฐัะตะปั
   ะัะฟัะฐะฒะบะฐ ัััะปะบะธ:
   https://gldwueprxkmbtqsnva.ru/pay?amount=500&qr=hash&request_id=123

6. ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั ัััะปะบั
   Payment Site โ Admin API
   GET /api/public/generate-qr?amount=500&bank=mbank

7. Payment Site ะฟะพะบะฐะทัะฒะฐะตั:
   - QR ะบะพะด ะดะปั ะพะฟะปะฐัั
   - ะะตะบะฒะธะทะธัั ะฑะฐะฝะบะฐ
   - ะขะฐะนะผะตั ะพะฑัะฐัะฝะพะณะพ ะพัััะตัะฐ
```

---

## ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั (PostgreSQL)

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะฝะตัะฝะธะน ัะตัะฒะตั `92.51.38.85:5432`

**ะะพะดะบะปััะตะฝะธะต:**
```
Host: 92.51.38.85
Port: 5432
Database: default_db
User: gen_user
Password: dastan10dz
```

**ะัะฝะพะฒะฝัะต ัะฐะฑะปะธัั:**
- `bot_users` - ะะพะปัะทะพะฒะฐัะตะปะธ ะฑะพัะฐ
- `requests` - ะะฐัะฒะบะธ ะฝะฐ ะฟะพะฟะพะปะฝะตะฝะธะต/ะฒัะฒะพะด
- `admin_users` - ะะดะผะธะฝะธัััะฐัะพัั ัะธััะตะผั
- `requisites` - ะะตะบะฒะธะทะธัั ะดะปั ะพะฟะปะฐั
- `transactions` - ะขัะฐะฝะทะฐะบัะธะธ
- `chat_messages` - ะกะพะพะฑัะตะฝะธั ัะฐัะฐ

---

## ๐ Nginx (Reverse Proxy)

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะธะฝะธะผะฐะตั HTTPS ะทะฐะฟัะพัั (ะฟะพัั 443)
- ะัะพะบัะธััะตั ะฝะฐ ะฒะฝัััะตะฝะฝะธะต ัะตัะฒะธัั (ะฟะพััั 3001, 3002)
- ะะฑะตัะฟะตัะธะฒะฐะตั SSL/TLS ัะธััะพะฒะฐะฝะธะต
- ะะฑัะฐะฑะฐััะฒะฐะตั ััะฐัะธัะตัะบะธะต ัะฐะนะปั

**ะะพะฝัะธะณััะฐัะธั:**

### Admin Panel (ะฟะพัั 3001)
```
https://fqxgmrzplndwsyvkeu.ru
    โ
Nginx (ะฟะพัั 443)
    โ
Next.js (localhost:3001)
```

### Payment Site (ะฟะพัั 3002)
```
https://gldwueprxkmbtqsnva.ru
    โ
Nginx (ะฟะพัั 443)
    โ
Flask/Gunicorn (localhost:3002)
```

---

## ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะพัะตััะฐะผะธ (PM2)

**ะงัะพ ะดะตะปะฐะตั PM2:**
- ะะฐะฟััะบะฐะตั ะธ ะพััะปะตะถะธะฒะฐะตั ะฒัะต ะฟัะพัะตััั
- ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะทะฐะฟััะบะฐะตั ะฟัะธ ัะฑะพัั
- ะกะพััะฐะฝัะตั ะปะพะณะธ
- ะะฑะตัะฟะตัะธะฒะฐะตั ะฐะฒัะพะทะฐะฟััะบ ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต ัะตัะฒะตัะฐ

**ะะพะผะฐะฝะดั:**
```bash
pm2 list              # ะกะฟะธัะพะบ ะฒัะตั ะฟัะพัะตััะพะฒ
pm2 logs              # ะัะพัะผะพัั ะปะพะณะพะฒ
pm2 restart all       # ะะตัะตะทะฐะฟััะบ ะฒัะตั
pm2 stop all          # ะััะฐะฝะพะฒะบะฐ ะฒัะตั
pm2 delete all        # ะฃะดะฐะปะตะฝะธะต ะฒัะตั
pm2 monit             # ะะพะฝะธัะพัะธะฝะณ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
pm2 save              # ะกะพััะฐะฝะตะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
pm2 startup           # ะะฐัััะพะนะบะฐ ะฐะฒัะพะทะฐะฟััะบะฐ
```

---

## ๐ ะะพััั ะฝะฐ ัะตัะฒะตัะต

| ะะพัั | ะกะตัะฒะธั | ะะพัััะฟ |
|------|--------|--------|
| 22 | SSH | ะัะฑะปะธัะฝัะน (ัะพะปัะบะพ ะดะปั ะฒะฐั) |
| 80 | HTTP | ะัะฑะปะธัะฝัะน (ัะตะดะธัะตะบั ะฝะฐ HTTPS) |
| 443 | HTTPS (Nginx) | ะัะฑะปะธัะฝัะน |
| 3001 | Next.js Admin | ะขะพะปัะบะพ ะปะพะบะฐะปัะฝัะน |
| 3002 | Flask Payment | ะขะพะปัะบะพ ะปะพะบะฐะปัะฝัะน |
| 5432 | PostgreSQL | ะะฝะตัะฝะธะน ัะตัะฒะตั |

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

1. **SSH ะบะปัั** - ะััะตะฝัะธัะธะบะฐัะธั ะฑะตะท ะฟะฐัะพะปั
2. **HTTPS** - ะจะธััะพะฒะฐะฝะธะต ะฒัะตั ัะพะตะดะธะฝะตะฝะธะน
3. **Firewall** - ะขะพะปัะบะพ ะฝัะถะฝัะต ะฟะพััั ะพัะบัััั
4. **ะะฝัััะตะฝะฝะธะต ะฟะพััั** - 3001 ะธ 3002 ะฝะต ะดะพัััะฟะฝั ะธะทะฒะฝะต
5. **JWT ัะพะบะตะฝั** - ะััะตะฝัะธัะธะบะฐัะธั ะฒ ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ
6. **ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั** - ะกะตะบัะตัั ะฒ .env ัะฐะนะปะฐั

---

## ๐ ะะพะณะธ ะธ ะผะพะฝะธัะพัะธะฝะณ

**ะะดะต ัะผะพััะตัั ะปะพะณะธ:**

```bash
# ะัะต ะฟัะพัะตััั PM2
pm2 logs

# ะะพะฝะบัะตัะฝัะน ะฟัะพัะตัั
pm2 logs bingo-admin
pm2 logs bingo-bot
pm2 logs bingo-payment

# Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# ะกะธััะตะผะฝัะต ะปะพะณะธ
journalctl -u nginx
```

---

## ๐ ะัะพัะตัั ัะฐะทะฒะตัััะฒะฐะฝะธั

1. **ะะพะดะบะปััะตะฝะธะต ะบ ัะตัะฒะตัั** ัะตัะตะท SSH
2. **ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน** (Node.js, Python, PM2, Nginx)
3. **ะะพะฟะธัะพะฒะฐะฝะธะต ะฟัะพะตะบัะฐ** ะฝะฐ ัะตัะฒะตั
4. **ะะฐัััะพะนะบะฐ .env ัะฐะนะปะพะฒ** ั ัะตะบัะตัะฐะผะธ
5. **ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน** ะฟัะพะตะบัะฐ (npm install, pip install)
6. **ะกะฑะพัะบะฐ Next.js** (npm run build)
7. **ะะฐะฟััะบ ัะตัะตะท PM2**
8. **ะะฐัััะพะนะบะฐ Nginx** ะดะปั ะฟัะพะบัะธัะพะฒะฐะฝะธั
9. **ะะพะปััะตะฝะธะต SSL ัะตััะธัะธะบะฐัะพะฒ**
10. **ะะฐัััะพะนะบะฐ ัะฐะนัะฒะพะปะฐ**

---

## โ ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

ะะพัะปะต ัะฐะทะฒะตัััะฒะฐะฝะธั ะฟัะพะฒะตัััะต:

```bash
# ะัะต ะฟัะพัะตััั ะทะฐะฟััะตะฝั
pm2 list
# ะะพะปะถะฝั ะฑััั: bingo-admin, bingo-bot, bingo-payment

# ะะพััั ัะปััะฐัััั
sudo netstat -tulpn | grep -E '3001|3002'
# ะะพะปะถะฝั ะฑััั ะฐะบัะธะฒะฝั

# Nginx ัะฐะฑะพัะฐะตั
sudo systemctl status nginx
# ะะพะปะถะตะฝ ะฑััั active (running)

# SSL ัะตััะธัะธะบะฐัั
sudo certbot certificates
# ะะพะปะถะฝั ะฑััั ะดะตะนััะฒะธัะตะปัะฝัะผะธ

# ะะพัััะฟะฝะพััั ัะฐะนัะพะฒ
curl https://fqxgmrzplndwsyvkeu.ru
curl https://gldwueprxkmbtqsnva.ru
```

---

## ๐ ะขะธะฟะธัะฝัะต ะฟัะพะฑะปะตะผั

**ะัะพะฑะปะตะผะฐ:** ะัะพัะตัั ะฝะต ะทะฐะฟััะบะฐะตััั
```bash
pm2 logs <ะธะผั> --err  # ะะพัะผะพััะตัั ะพัะธะฑะบะธ
```

**ะัะพะฑะปะตะผะฐ:** ะะตั ะฟะพะดะบะปััะตะฝะธั ะบ ะะ
```bash
psql -h 92.51.38.85 -U gen_user -d default_db
```

**ะัะพะฑะปะตะผะฐ:** Nginx ะฝะต ะฟัะพะบัะธััะตั
```bash
sudo nginx -t  # ะัะพะฒะตัะธัั ะบะพะฝัะธะณััะฐัะธั
sudo tail -f /var/log/nginx/error.log
```

**ะัะพะฑะปะตะผะฐ:** SSL ัะตััะธัะธะบะฐั ะธััะตะบ
```bash
sudo certbot renew
sudo systemctl reload nginx
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะธะฝัะพัะผะฐัะธั

- **ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ:** `SERVER_SETUP.md`
- **ะัััััะน ััะฐัั:** `QUICK_START_RU.md`
- **ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธะทะฐัะธะธ:** `deploy.sh`

---

**ะฃะดะฐัะธ ะฒ ัะฐะฑะพัะต! ๐**









