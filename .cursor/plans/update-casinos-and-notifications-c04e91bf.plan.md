<!-- c04e91bf-bf10-4cbe-aa34-02e8bad42cf5 14107b0f-22f3-4061-97b9-6ae28c545d51 -->
# План обновления казино и уведомлений

## Задачи

### 1. Обновить список казино

- **Файлы**: `telegram_bot/config.py`, `admin_nextjs/app/dashboard/settings/page.tsx`, `admin_nextjs/app/api/settings/route.ts`, `admin_nextjs/app/api/public/payment-settings/route.ts`
- Заменить текущий список на: 1win, 1xBet, Melbet, Winwin, 1xCasino, 888starz, BetWinner, mostbet
- Обновить дефолтные настройки казино в админке

### 2. Динамическая загрузка казино и банков из API

- **Файлы**: `telegram_bot/api_client.py`, `telegram_bot/handlers/deposit.py`, `telegram_bot/handlers/withdraw.py`
- Добавить метод `get_payment_settings()` в `APIClient` для получения настроек из `/api/public/payment-settings`
- Фильтровать казино и банки по настройкам из админки (показывать только включенные)
- Обновить обработчики deposit/withdraw для использования динамического списка

### 3. Добавить переводы для всех текстов

- **Файл**: `telegram_bot/translations.py`
- Добавить переводы для новых казино (если нужно)
- Проверить, что все тексты имеют переводы на кыргызский

### 4. Уведомления боту о принятых заявках

- **Файлы**: `admin_nextjs/app/api/requests/[id]/route.ts`, `admin_nextjs/app/api/deposit-balance/route.ts`
- При изменении статуса заявки на `completed` или `autodeposit_success` отправлять уведомление пользователю через Telegram API
- Добавить переводы для уведомлений (русский и кыргызский)

### 5. Обновить сайт оплаты и добавить генерацию QR

- **Файлы**: `payment_site/templates/pay.html`, `admin_nextjs/app/api/public/generate-qr/route.ts`
- Улучшить дизайн сайта оплаты (минималистичный, красивые блоки)
- Добавить генерацию QR-хеша для разных банков:
- **Bakai**: использовать base_hash, менять только поле 54 (сумма) и пересчитывать контрольную сумму (поле 63)
- **DemirBank**: использовать base_hash `00020101021132590015qr.demirbank.kg01047001101611800003603864311202111302125204482953034175405500945909DEMIRBANK63047803`, менять:
- Реквизит (16 цифр) - брать активный из админки через API `/api/requisites/list`
- Поле 54 (сумма в копейках, 5 цифр)
- Поле 63 (контрольная сумма SHA256, последние 4 символа в нижнем регистре)
- Один qrHash работает для всех банков, каждый банк использует свой домен
- Получать активный кошелек/реквизит из админки по API (`/api/requisites/list` или `/api/public/requisites/list`)
- На сайте: QR код не меняется при смене банка, по умолчанию ссылка на O!Money
- Добавить загрузку фото чека на сайте оплаты
- Сохранять фото чека в заявку и отображать в админке

### 6. Проверка и доработка бота

- **Файлы**: `telegram_bot/handlers/deposit.py`, `payment_site/templates/pay.html`
- Убедиться, что при отмене возвращается главное меню (уже реализовано)
- После успешной оплаты возвращать пользователя в главное меню бота
- Проверить корректность работы всех функций

## Детали реализации

### API для получения настроек

Бот будет запрашивать `/api/public/payment-settings` и получать:

- `casinos`: объект с включенными казино `{ '1win': true, '1xbet': true, ... }`
- `deposits.banks`: массив включенных банков для пополнения
- `withdrawals.banks`: массив включенных банков для вывода

### Уведомления

При успешном пополнении отправлять сообщение:

- Русский: "✅ Пополнение успешно! Сумма: {amount} KGS. Казино: {casino}. ID: {account_id}"
- Кыргызский: "✅ Толтуруу ийгиликтүү! Сумма: {amount} KGS. Казино: {casino}. ID: {account_id}"